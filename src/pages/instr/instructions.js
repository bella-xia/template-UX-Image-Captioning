import React, { Component, useState, useEffect } from "react";
import { Button, Modal, Checkbox, Row, Col } from "antd";
import "./instructions.css";


function InstructionsContainer() {
  const [agree, setAgree] = useState(false);
  const [display, setDisplay] = useState(false);
  const [acceptFirst, setAcceptFirst] = useState(false);
  const [doneExample, setDoneExample] = useState(false);
  const [example, setExample] = useState("IMPROVED");


  
  //   const [task, setTask] = useState(0);

  const checkboxHandler = () => {
    setAgree(!agree);
  };

  const continueChange = () =>{ 
    setAcceptFirst(true);
   }  

  const displayChange =  () => {
    setDisplay(true);
  }

  const exampleChange = () => {
    setDoneExample(true);
    setExample("STILL POOR");
  }

  const lastChange = () => {
    let path = "/#/EyeGazeStart"; // change back
    window.location.assign(path);
    console.log('opening popup')
    // if (task % 2 === 0) {
    //     let path = '/#/Main2';
    //     window.location.assign(path);
    // } else {
    //     let path = '/#/Main1';
    //     window.location.assign(path);
    // }
  };


    // connect with the backend to get a user ID and randomize agent  
    useEffect(() => {
      fetch('http://127.0.0.1:8080/setup')
      .then(response => response.json())
      .then(data => {
          console.log(data)
          // setTask(data['agent_number']);
          // send user id as well
          localStorage.setItem('user-id', data['user_id']);
      });
  }, []);

  return (
    <div className="container">
      <h1>Study Instructions</h1>

      {!acceptFirst ?
      <> 

      <div style={{fontSize: "20px", textAlign: "left", width:"75%", marginLeft: "10%"}}>
  
        <ul> 
          <li> <b>Overall description:</b> Image captioning is the process of describing the content of an image in words. The textual description of an image can be then converted to speech, making images <b>more accessible</b> to visually impaired audiences. We are looking for people to help us in the development of algorithms that enhance digital accessibility. Human insights are essential for refining and improving such tools. </li>

          <li> <b>Goal:</b> Provide the best quality captions to enable a person with visual impairment to build memories and experiences from the photographs they encounter. </li>

          <li> <b>Task:</b> Write captions of <b>12 images</b> that mostly involve human actions in different contexts. </li> 

          <li> <b>How: </b> You will collaborate with an <b>Artificial Intelligence (AI) model</b> that generates captions automatically. </li>

        
        </ul>

        </div>

        {!display ? 
            <Button variant="btn btn-success" onClick={displayChange} style={{marginTop: "10px", marginBottom: "10px"}}>
                Read more
            </Button>

      : 
      <> 
        
        <div style={{fontSize: "20px", textAlign: "left", width:"75%", marginLeft: "10%", marginTop: "-20px"}}>
        <ul> 
        <li> <b>Process:</b> read the following steps to complete the study:</li>
        </ul> 

        <div style={{marginTop: "-20px", marginLeft: "35px"}}>
          <ol>
            <li> For each image, you will be presented the <b>original caption</b> generated by an  <b>AI model</b>. </li>
            <li> Make the corresponding changes that will <b>improve the quality</b> of the caption. You can make <b>type</b> or <b>delete edits</b> at the <b>character level at any location in the caption</b>. You can see the initial caption with the tracked changes you have made. </li>
            <li> There are <b>Undo</b> and <b>Reset</b> buttons that you can use as you modify the captions. </li>
            <li> Once you are satisfied with your final caption version, continue to the next image. Your caption will be saved.</li>
            <li> You can click to go back to the previous image only if you want to make any further change. Only use the Back and Next buttons to navigate. <b>Do not</b> use the browserâ€™s back option or reload the webpage. </li>
            <li> Repeat this process with all the images and then complete a final survey.</li>
          </ol>
        </div>

        <div style={{fontSize: "20px", textAlign: "left", marginLeft: "2.5%", marginTop: "-20px"}}>
          NOTE: As you write the captions, <b>DO NOT</b> speculate about what people in the image might be saying or thinking, or events that might have happened in the past or future.
        </div>


        <Checkbox
          onChange={checkboxHandler}
          style={{ fontSize: "20px", textAlign: "left", alignSelf: "stretch", marginTop: "-40px"}}
        >
          I read and understand the conditions. 
        </Checkbox>
      </div>

      <Button disabled={!agree} variant="btn btn-success" onClick={continueChange} style={{marginTop: "1px", marginBottom: "10px"}}>
            Continue
      </Button>
      </>
      }
      </>
      : 
      <>

      <div style={{fontSize: "20px", textAlign: "left", width: "75%", marginLeft: "10%"}}> 
      <p>  Before you start, let's consider some guidelines for writing captions:  </p>

      <ul> 
        <li> As you write the captions, describe the <b>information an image conveys</b> and the <b>visual details</b> that may be important to a person with visual impairments.</li>
        <li> Your captions should be <b>descriptive</b>, <b>concise</b>, and <b>relevant</b>, by considering:</li>
        <ol>
          <li> What are the main subjects? </li>
          <li> What is the action that is happening or group activity? </li>
          <li> What is the setting or environment and when (timing) does the image takes place? </li>
          <li> What is the emotion communicated? </li>
        </ol>
      </ul>

      Now, consider the following example where the caption quality was <b>{example}</b>:      
      </div>

      {!doneExample ? 
        <> 
        <Row type="flex" justify="center">
        <Col span={11} type="flex" align="middle" >
            <img src={'./image_folder/Image_30.png'} width="350" height="auto"/>

        </Col>


        <Col span={10} align="left">
            <div className="text">
            <b>Initial caption:</b> A child in a blue shirt stands by a river, with an old town skyline in the distance
            </div>

            <div className="text">
            <b>Modified caption:</b> A young boy wearing a blue sleeveless shirt stands at the river's edge, poised to throw a stone. In the background, the silhouette of a cathedral with twin spires rises above the cityscape, with a bridge spanning the river to the right. The sky is partly cloud
            </div>
            <div className="text">
            <b>Why did it improve?</b> includes information about the action that is happening, the subject, and the setting/background. 
            </div>
        </Col>
        </Row>

        <div> 
        <Button
          variant="btn btn-success"
          onClick={exampleChange}
          style={{ marginTop: "30px" }}
        >
          Next Example
        </Button>
      </div>
        
        </>       
      : 
        <> 
        <Row type="flex" justify="center">
        <Col span={11} type="flex" align="middle" >
            <img src={'./image_folder/Image_33.png'} width="350" height="auto"/>

        </Col>

        <Col span={10} align="left">
            <div className="text">
            <b>Initial caption:</b> A group of children with helmets are seated on a small farm tractor in a backyard, preparing for a ride.
            </div>
            <div className="text">
            <b>Modified caption:</b> A group of four female children with helmets seated on a quad bike in a backyard, preparing for a ride. 
            </div>
            <div className="text">
            <b>Why is the quality still low?</b> misses context information, such as the mountains in the back, the fence, and details of the subjects, e.g., smiling, looking at the camera or away. 
            </div>
        </Col>
        </Row>

        <div> 
        <Button
          variant="btn btn-success"
          onClick={lastChange}
          style={{ marginTop: "30px" }}
        >
          Continue
        </Button>
      </div>
         
        </> 
      }
      </>
      }
    </div>
  );
}

export default InstructionsContainer;
